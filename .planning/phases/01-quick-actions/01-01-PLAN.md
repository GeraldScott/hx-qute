---
phase: 01-quick-actions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/java/io/archton/scaffold/router/PersonResource.java
  - src/main/resources/templates/PersonResource/person.html
autonomous: true

must_haves:
  truths:
    - "User can click a 'View Network' link on any person row in the person list and navigate to the /graph page"
    - "User can click a 'View Details' button on any person row to see that person's details in a modal"
    - "Both action buttons remain visible on a row after editing that person (modal_success_row parity)"
    - "The detail modal displays person name, email, phone, date of birth, gender, notes, and audit information"
  artifacts:
    - path: "src/main/java/io/archton/scaffold/router/PersonResource.java"
      provides: "GET /persons/{id} detail endpoint returning modal_detail fragment"
      contains: "person$modal_detail"
    - path: "src/main/resources/templates/PersonResource/person.html"
      provides: "modal_detail fragment, View Network and View Details buttons in table and modal_success_row"
      contains: "modal_detail"
  key_links:
    - from: "person.html (table fragment, View Details button)"
      to: "PersonResource.detail() endpoint"
      via: "hx-get=/persons/{id}"
      pattern: "hx-get=\"/persons/\\{p\\.id\\}\""
    - from: "person.html (table fragment, View Network link)"
      to: "/graph page"
      via: "href=/graph"
      pattern: "href=\"/graph\""
    - from: "PersonResource.detail()"
      to: "person.html modal_detail fragment"
      via: "@CheckedTemplate person$modal_detail"
      pattern: "person\\$modal_detail"
---

<objective>
Add "View Network" and "View Details" quick action buttons to each person row in the person list table.

Purpose: Enables investigators to quickly navigate to the relationship graph and view person details directly from the person list, reducing navigation friction.
Output: Two new action buttons per person row + a read-only detail modal + one new REST endpoint.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-quick-actions/01-RESEARCH.md
@src/main/java/io/archton/scaffold/router/PersonResource.java
@src/main/resources/templates/PersonResource/person.html
@src/main/java/io/archton/scaffold/entity/Person.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add detail endpoint and template fragment for person detail modal (ACT-02)</name>
  <files>
    src/main/java/io/archton/scaffold/router/PersonResource.java
    src/main/resources/templates/PersonResource/person.html
  </files>
  <action>
    **In PersonResource.java:**

    1. Add a new `@CheckedTemplate` method to the `Templates` inner class:
       ```java
       public static native TemplateInstance person$modal_detail(Person person);
       ```
       Place it after the `person$modal_delete` method declaration (around line 82).

    2. Add a new `GET /persons/{id}` endpoint method:
       ```java
       @GET
       @Path("/{id}")
       @Produces(MediaType.TEXT_HTML)
       public TemplateInstance detail(@PathParam("id") Long id) {
           Person person = personRepository.findById(id);
           if (person == null) {
               return Templates.person$modal_detail(new Person());
           }
           return Templates.person$modal_detail(person);
       }
       ```
       Place it after the `list()` method and before `createForm()` (around line 131). This follows the existing pattern used by `editForm()` and `deleteForm()`.

    **In person.html:**

    3. Add a new `modal_detail` fragment BEFORE the `modal_delete` fragment (before line 336). The fragment renders a read-only detail view:
       ```html
       {#fragment id='modal_detail' rendered=false}
       {@io.archton.scaffold.entity.Person person}
       <h2 class="uk-modal-title">Person Details</h2>
       {#if person.id??}
       <dl class="uk-description-list">
           <dt>Name</dt>
           <dd>{person.getDisplayName()}</dd>

           <dt>Email</dt>
           <dd>{person.email}</dd>

           {#if person.phone}
           <dt>Phone</dt>
           <dd>{person.phone}</dd>
           {/if}

           {#if person.dateOfBirth}
           <dt>Date of Birth</dt>
           <dd>{person.dateOfBirth.format('dd MMM yyyy')}</dd>
           {/if}

           {#if person.gender??}
           <dt>Gender</dt>
           <dd>{person.gender.description}</dd>
           {/if}

           {#if person.notes}
           <dt>Notes</dt>
           <dd>{person.notes}</dd>
           {/if}
       </dl>
       <details class="uk-margin">
           <summary class="uk-text-muted">Audit Information</summary>
           <div class="uk-text-small uk-text-muted uk-margin-small-top">
               <div>Created: {person.createdAt} by {person.createdBy}</div>
               <div>Updated: {person.updatedAt} by {person.updatedBy}</div>
           </div>
       </details>
       {#else}
       <div class="uk-alert uk-alert-danger">Person not found.</div>
       {/if}
       <div class="uk-margin uk-text-right">
           <button class="uk-button uk-button-default uk-modal-close" type="button">Close</button>
       </div>
       {/fragment}
       ```

    **Key details:**
    - The fragment checks `person.id??` to handle the not-found case (when `new Person()` is passed)
    - Uses `uk-description-list` for clean read-only display
    - Includes audit info in a collapsible `<details>` element (same pattern as the edit modal)
    - Close button uses `uk-modal-close` to dismiss the modal
  </action>
  <verify>
    Trigger dev server reload: `curl -s http://127.0.0.1:9080/q/health`
    Then verify the endpoint returns HTML: `curl -s -b cookie.txt http://127.0.0.1:9080/persons/1 | grep "Person Details"`
    If no cookie available, at minimum verify the app compiles without errors by checking the health endpoint returns 200.
  </verify>
  <done>
    GET /persons/{id} returns a modal_detail fragment containing the person's name, email, and a "Close" button. GET /persons/{id} for a non-existent ID returns a "Person not found" error message.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add View Network and View Details action buttons to person table rows (ACT-01, ACT-02)</name>
  <files>
    src/main/resources/templates/PersonResource/person.html
  </files>
  <action>
    Add two new action buttons to the person table row's button group in TWO locations within `person.html`:

    **CRITICAL: Both locations must receive identical button markup.** Failure to update both causes buttons to disappear after editing a person.

    **Location 1: The `table` fragment** (around lines 114-140 in the `{#for p in persons}` loop)

    Insert the following two buttons AFTER the existing "Manage Relationships" link (`<a>` with `uk-icon="link"`) and BEFORE the "Edit Person" button (`<button>` with `uk-icon="pencil"`):

    ```html
    <a class="uk-button uk-button-small uk-button-default"
       href="/graph"
       uk-tooltip="View Network">
        <span uk-icon="git-fork"></span>
    </a>
    <button class="uk-button uk-button-small uk-button-default"
            hx-get="/persons/{p.id}"
            hx-target="#person-modal-body"
            hx-on::after-request="UIkit.modal('#person-modal').show()"
            uk-tooltip="View Details">
        <span uk-icon="info"></span>
    </button>
    ```

    **Location 2: The `modal_success_row` fragment** (around lines 310-329)

    Insert identical buttons (using `{person.id}` instead of `{p.id}` since this fragment uses `person` as its parameter name) AFTER the "Manage Relationships" link and BEFORE the "Edit Person" button:

    ```html
    <a class="uk-button uk-button-small uk-button-default"
       href="/graph"
       uk-tooltip="View Network">
        <span uk-icon="git-fork"></span>
    </a>
    <button class="uk-button uk-button-small uk-button-default"
            hx-get="/persons/{person.id}"
            hx-target="#person-modal-body"
            hx-on::after-request="UIkit.modal('#person-modal').show()"
            uk-tooltip="View Details">
        <span uk-icon="info"></span>
    </button>
    ```

    **Button order in both locations (left to right):**
    1. Manage Relationships (existing, `uk-icon="link"`)
    2. View Network (NEW, `uk-icon="git-fork"`)
    3. View Details (NEW, `uk-icon="info"`)
    4. Edit Person (existing, `uk-icon="pencil"`)
    5. Delete Person (existing, `uk-icon="trash"`)

    **Rationale for button placement:** Navigation actions (links, network, details) come before mutation actions (edit, delete). This groups read-only actions together and keeps destructive actions at the end.
  </action>
  <verify>
    Trigger dev server reload: `curl -s http://127.0.0.1:9080/q/health`
    Then verify buttons appear in the table HTML:
    - `curl -s -b cookie.txt http://127.0.0.1:9080/persons | grep 'uk-icon="git-fork"'` (should find matches)
    - `curl -s -b cookie.txt http://127.0.0.1:9080/persons | grep 'uk-icon="info"'` (should find matches)
    - `curl -s -b cookie.txt http://127.0.0.1:9080/persons | grep 'View Network'` (should find tooltip text)
    - `curl -s -b cookie.txt http://127.0.0.1:9080/persons | grep 'View Details'` (should find tooltip text)
    Verify both fragments have the new buttons (count occurrences -- should appear in both table and modal_success_row).
  </verify>
  <done>
    Every person row in the person list shows 5 action buttons (Manage Relationships, View Network, View Details, Edit, Delete). The View Network button is an `<a>` tag linking to `/graph`. The View Details button triggers an HTMX GET to `/persons/{id}` and displays the detail modal. After editing a person, the row still shows all 5 buttons (modal_success_row parity confirmed).
  </done>
</task>

</tasks>

<verification>
1. Navigate to `/persons` -- every row should show 5 action buttons in the correct order
2. Click "View Network" (git-fork icon) on any row -- should navigate to `/graph` page
3. Click "View Details" (info icon) on any row -- should open a modal showing that person's name, email, and other details
4. Close the detail modal -- should return to the person list unchanged
5. Edit a person via the Edit button -- after save, the row should still show all 5 action buttons (modal_success_row parity)
6. The detail modal for a non-existent person (e.g., manually requesting `/persons/99999`) should show "Person not found"
</verification>

<success_criteria>
- ACT-01 satisfied: Each person row has a "View Network" link that navigates to `/graph`
- ACT-02 satisfied: Each person row has a "View Details" button that opens a read-only detail modal via HTMX
- Both buttons survive row re-rendering after edit operations (modal_success_row fragment parity)
- No regressions: existing Manage Relationships, Edit, and Delete buttons still work
</success_criteria>

<output>
After completion, create `.planning/phases/01-quick-actions/01-01-SUMMARY.md`
</output>
