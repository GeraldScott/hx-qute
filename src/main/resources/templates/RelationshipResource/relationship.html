{@String title}
{@String currentPage}
{@String userName}
{@java.util.List<io.archton.scaffold.entity.Relationship> relationships}
{#include base}

<h2 class="uk-heading-small">Relationship Code Maintenance</h2>

<!-- Add Button - triggers modal AND loads content via HTMX -->
<button
    class="uk-button uk-button-primary uk-button-small uk-margin-bottom"
    type="button"
    hx-get="/relationships/create"
    hx-target="#relationship-modal-body"
    hx-on::after-request="UIkit.modal('#relationship-modal').show()"
    uk-tooltip="Add Relationship"
>
    <span uk-icon="plus"></span>
</button>

<div id="relationship-table-container">{#include $table /}</div>

<!-- Static Modal Shell (always present in DOM) -->
<div id="relationship-modal" uk-modal="bg-close: false">
    <div class="uk-modal-dialog uk-modal-container">
        <div id="relationship-modal-body" class="uk-modal-body">
            <!-- Content loaded dynamically via HTMX -->
        </div>
    </div>
</div>

{/include}

{#fragment id='table'}
{@java.util.List<io.archton.scaffold.entity.Relationship> relationships}
{#if relationships.isEmpty()}
<p class="uk-text-muted">No relationships found.</p>
{#else}
<div class="uk-overflow-auto">
    <table id="relationship-table" class="uk-table uk-table-hover uk-table-divider">
        <thead>
            <tr>
                <th class="uk-table-shrink">Code</th>
                <th class="uk-table-expand">Description</th>
                <th class="uk-width-small">Actions</th>
            </tr>
        </thead>
        <tbody id="relationship-table-body">
            {#for r in relationships}
            <tr id="relationship-row-{r.id}">
                <td>{r.code}</td>
                <td>{r.description}</td>
                <td>
                    <div class="uk-button-group">
                        <button
                            class="uk-button uk-button-small uk-button-primary"
                            hx-get="/relationships/{r.id}/edit"
                            hx-target="#relationship-modal-body"
                            hx-on::after-request="UIkit.modal('#relationship-modal').show()"
                            uk-tooltip="Edit Relationship"
                        >
                            <span uk-icon="pencil"></span>
                        </button>
                        <button
                            class="uk-button uk-button-small uk-button-danger"
                            hx-get="/relationships/{r.id}/delete"
                            hx-target="#relationship-modal-body"
                            hx-on::after-request="UIkit.modal('#relationship-modal').show()"
                            uk-tooltip="Delete Relationship"
                        >
                            <span uk-icon="trash"></span>
                        </button>
                    </div>
                </td>
            </tr>
            {/for}
        </tbody>
    </table>
</div>
{/if}
{/fragment}

{#fragment id='modal_create' rendered=false}
{@io.archton.scaffold.entity.Relationship relationship}
{@String error}
<h2 class="uk-modal-title">Add Relationship</h2>
{#if error??}
<div class="uk-alert uk-alert-danger">{error}</div>
{/if}
<form hx-post="/relationships" hx-target="#relationship-modal-body" class="uk-form-stacked">
    <div class="uk-margin">
        <label class="uk-form-label" for="create-relationship-code">Code *</label>
        <input class="uk-input" type="text" id="create-relationship-code" name="code" maxlength="10" value="{relationship.code ?: ''}" required />
    </div>
    <div class="uk-margin">
        <label class="uk-form-label" for="create-relationship-description">Description *</label>
        <input class="uk-input" type="text" id="create-relationship-description" name="description" value="{relationship.description ?: ''}" required />
    </div>
    <div class="uk-margin uk-text-right">
        <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
        <button class="uk-button uk-button-primary" type="submit">Save</button>
    </div>
</form>
{/fragment}

{#fragment id='modal_edit' rendered=false}
{@io.archton.scaffold.entity.Relationship relationship}
{@String error}
<h2 class="uk-modal-title">Edit Relationship</h2>
{#if error??}
<div class="uk-alert uk-alert-danger">{error}</div>
{/if}
<form hx-put="/relationships/{relationship.id}" hx-target="#relationship-modal-body" class="uk-form-stacked">
    <div class="uk-margin">
        <label class="uk-form-label" for="edit-relationship-code">Code *</label>
        <input class="uk-input" type="text" id="edit-relationship-code" name="code" maxlength="10" value="{relationship.code ?: ''}" required />
    </div>
    <div class="uk-margin">
        <label class="uk-form-label" for="edit-relationship-description">Description *</label>
        <input class="uk-input" type="text" id="edit-relationship-description" name="description" value="{relationship.description ?: ''}" required />
    </div>
    <details class="uk-margin">
        <summary class="uk-text-muted">Audit Information</summary>
        <div class="uk-text-small uk-text-muted uk-margin-small-top">
            <div>Created: {relationship.createdAt} by {relationship.createdBy}</div>
            <div>Updated: {relationship.updatedAt} by {relationship.updatedBy}</div>
        </div>
    </details>
    <div class="uk-margin uk-text-right">
        <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
        <button class="uk-button uk-button-primary" type="submit">Save</button>
    </div>
</form>
{/fragment}

{#fragment id='modal_success' rendered=false}
{@String message}
{@java.util.List<io.archton.scaffold.entity.Relationship> relationships}
<div hx-on::load="UIkit.modal('#relationship-modal').hide()"></div>
<div id="relationship-table-container" hx-swap-oob="innerHTML">
    {#include $table relationships=relationships /}
</div>
{/fragment}

{#fragment id='modal_success_row' rendered=false}
{@String message}
{@io.archton.scaffold.entity.Relationship relationship}
<div hx-on::load="UIkit.modal('#relationship-modal').hide()"></div>
<template>
<tr id="relationship-row-{relationship.id}" hx-swap-oob="outerHTML">
    <td>{relationship.code}</td>
    <td>{relationship.description}</td>
    <td>
        <div class="uk-button-group">
            <button class="uk-button uk-button-small uk-button-primary"
                    hx-get="/relationships/{relationship.id}/edit"
                    hx-target="#relationship-modal-body"
                    hx-on::after-request="UIkit.modal('#relationship-modal').show()"
                    uk-tooltip="Edit Relationship">
                <span uk-icon="pencil"></span>
            </button>
            <button class="uk-button uk-button-small uk-button-danger"
                    hx-get="/relationships/{relationship.id}/delete"
                    hx-target="#relationship-modal-body"
                    hx-on::after-request="UIkit.modal('#relationship-modal').show()"
                    uk-tooltip="Delete Relationship">
                <span uk-icon="trash"></span>
            </button>
        </div>
    </td>
</tr>
</template>
{/fragment}

{#fragment id='modal_delete' rendered=false}
{@io.archton.scaffold.entity.Relationship relationship}
{@String error}
<h2 class="uk-modal-title">Delete Relationship</h2>
{#if error??}
<div class="uk-alert uk-alert-danger">{error}</div>
{#else}
<div class="uk-alert uk-alert-warning">
    Are you sure you want to delete <strong>{relationship.code}</strong> - <strong>{relationship.description}</strong>?
</div>
<p class="uk-text-muted">This action cannot be undone.</p>
{/if}
<div class="uk-margin uk-text-right">
    <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
    {#if !error??}
    <button class="uk-button uk-button-danger"
            hx-delete="/relationships/{relationship.id}"
            hx-target="#relationship-modal-body">
        Delete
    </button>
    {/if}
</div>
{/fragment}

{#fragment id='modal_delete_success' rendered=false}
{@Long deletedId}
<div hx-on::load="UIkit.modal('#relationship-modal').hide()"></div>
<template><tr id="relationship-row-{deletedId}" hx-swap-oob="delete"></tr></template>
{/fragment}
