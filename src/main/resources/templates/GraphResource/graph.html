{@java.util.List<io.archton.scaffold.entity.Relationship> relationships}
{#include base.html}
{#title}Network Graph{/title}

<!-- D3.js loaded only on this page -->
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>

<div class="uk-flex uk-flex-between uk-flex-middle uk-margin-bottom">
    <h1 class="uk-heading-small uk-margin-remove">Network Graph</h1>
</div>

<!-- Controls -->
<div class="uk-card uk-card-default uk-card-small uk-card-body uk-margin-bottom">
    <div class="uk-grid-small uk-flex-middle" uk-grid>
        <div class="uk-width-1-4@m">
            <input type="text" id="graph-search" class="uk-input uk-form-small"
                   placeholder="Search by name...">
        </div>
        <div class="uk-width-1-4@m">
            <select id="relationship-filter" class="uk-select uk-form-small">
                <option value="">All Relationships</option>
                {#for rel in relationships}
                <option value="{rel.code}">{rel.description}</option>
                {/for}
            </select>
        </div>
        <div class="uk-width-expand@m uk-text-right">
            <button id="reset-graph" class="uk-button uk-button-default uk-button-small">
                <span uk-icon="icon: refresh; ratio: 0.8"></span> Reset View
            </button>
        </div>
    </div>
</div>

<!-- Graph Container -->
<div id="graph-container" class="uk-card uk-card-default uk-card-body"
     style="height: 600px; padding: 0; overflow: hidden;">
    <div id="graph-empty" class="uk-flex uk-flex-center uk-flex-middle" style="height: 100%; display: none;">
        <div class="uk-text-center uk-text-muted">
            <span uk-icon="icon: users; ratio: 3"></span>
            <p class="uk-margin-small-top">No people to display</p>
        </div>
    </div>
    <svg id="graph-svg" style="width: 100%; height: 100%;"></svg>
</div>

<!-- Legend -->
<div class="uk-margin-top">
    <div class="uk-flex uk-flex-wrap uk-flex-middle" uk-grid>
        <div class="uk-flex uk-flex-middle uk-margin-small-right">
            <span style="display: inline-block; width: 16px; height: 16px; border-radius: 50%; background: #FF69B4; margin-right: 4px;"></span>
            <span class="uk-text-small">Female</span>
        </div>
        <div class="uk-flex uk-flex-middle uk-margin-small-right">
            <span style="display: inline-block; width: 16px; height: 16px; border-radius: 50%; background: #4169E1; margin-right: 4px;"></span>
            <span class="uk-text-small">Male</span>
        </div>
        <div class="uk-flex uk-flex-middle">
            <span style="display: inline-block; width: 16px; height: 16px; border-radius: 50%; background: #808080; margin-right: 4px;"></span>
            <span class="uk-text-small">Not Specified</span>
        </div>
    </div>
</div>

<!-- Custom Context Menu (positioned via JS) -->
<div id="node-context-menu" class="uk-card uk-card-default uk-card-small" style="display: none; position: fixed; z-index: 1000; min-width: 180px; box-shadow: 0 5px 12px rgba(0,0,0,0.15);">
    <ul class="uk-nav uk-nav-default">
        <li><a href="#" id="ctx-view-details"><span uk-icon="icon: info; ratio: 0.8"></span> View Details</a></li>
        <li class="uk-nav-divider"></li>
        <li><a href="#" id="ctx-manage-relationships"><span uk-icon="icon: link; ratio: 0.8"></span> Manage Relationships</a></li>
    </ul>
</div>

<!-- Person Details Modal -->
<div id="person-modal" uk-modal>
    <div class="uk-modal-dialog">
        <button class="uk-modal-close-default" type="button" uk-close></button>
        <div class="uk-modal-header">
            <h2 class="uk-modal-title">Person Details</h2>
        </div>
        <div id="person-modal-content" class="uk-modal-body">
            <!-- Loaded via HTMX -->
        </div>
    </div>
</div>

<script src="/js/graph.js"></script>
{/}
