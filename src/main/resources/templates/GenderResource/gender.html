{@String title}
{@String currentPage}
{@String userName}
{@java.util.List<io.archton.scaffold.entity.Gender> genders}
{#include base}
{#title}{title}{/title}

<h2 class="uk-heading-small">Gender Code Maintenance</h2>

<!-- Add Button - triggers modal AND loads content via HTMX -->
<button
    class="uk-button uk-button-primary uk-button-small uk-margin-bottom"
    type="button"
    hx-get="/genders/create"
    hx-target="#gender-modal-body"
    hx-on::after-request="UIkit.modal('#gender-modal').show()"
    uk-tooltip="Add Gender"
>
    <span uk-icon="plus"></span>
</button>

<div id="gender-table-container">{#include $table /}</div>

<!-- Static Modal Shell (always present in DOM) -->
<div id="gender-modal" uk-modal="bg-close: false">
    <div class="uk-modal-dialog uk-modal-container">
        <div id="gender-modal-body" class="uk-modal-body">
            <!-- Content loaded dynamically via HTMX -->
        </div>
    </div>
</div>

{/include}

{#fragment id='table'}
{@java.util.List<io.archton.scaffold.entity.Gender> genders}
{#if genders.isEmpty()}
<p class="uk-text-muted">No genders found.</p>
{#else}
<div class="uk-overflow-auto">
    <table id="gender-table" class="uk-table uk-table-hover uk-table-divider">
        <thead>
            <tr>
                <th class="uk-table-shrink">Code</th>
                <th class="uk-table-expand">Description</th>
                <th class="uk-width-small">Actions</th>
            </tr>
        </thead>
        <tbody id="gender-table-body">
            {#for g in genders}
            <tr id="gender-row-{g.id}">
                <td>{g.code}</td>
                <td>{g.description}</td>
                <td>
                    <div class="uk-button-group">
                        <button
                            class="uk-button uk-button-small uk-button-primary"
                            hx-get="/genders/{g.id}/edit"
                            hx-target="#gender-modal-body"
                            hx-on::after-request="UIkit.modal('#gender-modal').show()"
                            uk-tooltip="Edit Gender"
                        >
                            <span uk-icon="pencil"></span>
                        </button>
                        <button
                            class="uk-button uk-button-small uk-button-danger"
                            hx-get="/genders/{g.id}/delete"
                            hx-target="#gender-modal-body"
                            hx-on::after-request="UIkit.modal('#gender-modal').show()"
                            uk-tooltip="Delete Gender"
                        >
                            <span uk-icon="trash"></span>
                        </button>
                    </div>
                </td>
            </tr>
            {/for}
        </tbody>
    </table>
</div>
{/if}
{/fragment}

{#fragment id='modal_create' rendered=false}
{@io.archton.scaffold.entity.Gender gender}
{@String error}
<h2 class="uk-modal-title">Add Gender</h2>
{#if error??}
<div class="uk-alert uk-alert-danger">{error}</div>
{/if}
<form hx-post="/genders" hx-target="#gender-modal-body">
    <div class="uk-margin">
        <label class="uk-form-label">Code *</label>
        <input class="uk-input" type="text" name="code" maxlength="1" value="{gender.code ?: ''}" required />
    </div>
    <div class="uk-margin">
        <label class="uk-form-label">Description *</label>
        <input class="uk-input" type="text" name="description" value="{gender.description ?: ''}" required />
    </div>
    <div class="uk-margin uk-text-right">
        <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
        <button class="uk-button uk-button-primary" type="submit">Save</button>
    </div>
</form>
{/fragment}

{#fragment id='modal_edit' rendered=false}
{@io.archton.scaffold.entity.Gender gender}
{@String error}
<h2 class="uk-modal-title">Edit Gender</h2>
{#if error??}
<div class="uk-alert uk-alert-danger">{error}</div>
{/if}
<form hx-put="/genders/{gender.id}" hx-target="#gender-modal-body">
    <div class="uk-margin">
        <label class="uk-form-label">Code *</label>
        <input class="uk-input" type="text" name="code" maxlength="1" value="{gender.code ?: ''}" required />
    </div>
    <div class="uk-margin">
        <label class="uk-form-label">Description *</label>
        <input class="uk-input" type="text" name="description" value="{gender.description ?: ''}" required />
    </div>
    <details class="uk-margin">
        <summary class="uk-text-muted">Audit Information</summary>
        <div class="uk-text-small uk-text-muted uk-margin-small-top">
            <div>Created: {gender.createdAt} by {gender.createdBy}</div>
            <div>Updated: {gender.updatedAt} by {gender.updatedBy}</div>
        </div>
    </details>
    <div class="uk-margin uk-text-right">
        <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
        <button class="uk-button uk-button-primary" type="submit">Save</button>
    </div>
</form>
{/fragment}

{#fragment id='modal_success' rendered=false}
{@String message}
{@java.util.List<io.archton.scaffold.entity.Gender> genders}
<div hx-on::load="UIkit.modal('#gender-modal').hide()"></div>
<div id="gender-table-container" hx-swap-oob="innerHTML">
    {#include $table genders=genders /}
</div>
{/fragment}

{#fragment id='modal_success_row' rendered=false}
{@String message}
{@io.archton.scaffold.entity.Gender gender}
<div hx-on::load="UIkit.modal('#gender-modal').hide()"></div>
<template>
<tr id="gender-row-{gender.id}" hx-swap-oob="outerHTML">
    <td>{gender.code}</td>
    <td>{gender.description}</td>
    <td>
        <div class="uk-button-group">
            <button class="uk-button uk-button-small uk-button-primary"
                    hx-get="/genders/{gender.id}/edit"
                    hx-target="#gender-modal-body"
                    hx-on::after-request="UIkit.modal('#gender-modal').show()"
                    uk-tooltip="Edit Gender">
                <span uk-icon="pencil"></span>
            </button>
            <button class="uk-button uk-button-small uk-button-danger"
                    hx-get="/genders/{gender.id}/delete"
                    hx-target="#gender-modal-body"
                    hx-on::after-request="UIkit.modal('#gender-modal').show()"
                    uk-tooltip="Delete Gender">
                <span uk-icon="trash"></span>
            </button>
        </div>
    </td>
</tr>
</template>
{/fragment}

{#fragment id='modal_delete' rendered=false}
{@io.archton.scaffold.entity.Gender gender}
{@String error}
<h2 class="uk-modal-title">Delete Gender</h2>
{#if error??}
<div class="uk-alert uk-alert-danger">{error}</div>
{#else}
<div class="uk-alert uk-alert-warning">
    Are you sure you want to delete <strong>{gender.code}</strong> - <strong>{gender.description}</strong>?
</div>
<p class="uk-text-muted">This action cannot be undone.</p>
{/if}
<div class="uk-margin uk-text-right">
    <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
    {#if !error??}
    <button class="uk-button uk-button-danger"
            hx-delete="/genders/{gender.id}"
            hx-target="#gender-modal-body">
        Delete
    </button>
    {/if}
</div>
{/fragment}

{#fragment id='modal_delete_success' rendered=false}
{@Long deletedId}
<div hx-on::load="UIkit.modal('#gender-modal').hide()"></div>
<template><tr id="gender-row-{deletedId}" hx-swap-oob="delete"></tr></template>
{/fragment}
