{@String title}
{@String currentPage}
{@String userName}
{@java.util.List<io.archton.scaffold.entity.Title> titles}
{#include base}
{#title}{title}{/title}

<h2 class="uk-heading-small">Title Code Maintenance</h2>

<!-- Add Button - triggers modal AND loads content via HTMX -->
<button
    class="uk-button uk-button-primary uk-button-small uk-margin-bottom"
    type="button"
    hx-get="/titles/create"
    hx-target="#title-modal-body"
    hx-on::after-request="UIkit.modal('#title-modal').show()"
    uk-tooltip="Add Title"
>
    <span uk-icon="plus"></span>
</button>

<div id="title-table-container">{#include $table /}</div>

<!-- Static Modal Shell (always present in DOM) -->
<div id="title-modal" uk-modal="bg-close: false">
    <div class="uk-modal-dialog uk-modal-container">
        <div id="title-modal-body" class="uk-modal-body">
            <!-- Content loaded dynamically via HTMX -->
        </div>
    </div>
</div>

{/include}

{#fragment id='table'}
{#if titles.isEmpty()}
<p class="uk-text-muted">No titles found.</p>
{#else}
<div class="uk-overflow-auto">
    <table id="title-table" class="uk-table uk-table-hover uk-table-divider">
        <thead>
            <tr>
                <th class="uk-table-shrink">Code</th>
                <th class="uk-table-expand">Description</th>
                <th class="uk-width-small">Actions</th>
            </tr>
        </thead>
        <tbody id="title-table-body">
            {#for t in titles}
            <tr id="title-row-{t.id}">
                <td>{t.code}</td>
                <td>{t.description}</td>
                <td>
                    <div class="uk-button-group">
                        <button
                            class="uk-button uk-button-small uk-button-primary"
                            hx-get="/titles/{t.id}/edit"
                            hx-target="#title-modal-body"
                            hx-on::after-request="UIkit.modal('#title-modal').show()"
                            uk-tooltip="Edit Title"
                        >
                            <span uk-icon="pencil"></span>
                        </button>
                        <button
                            class="uk-button uk-button-small uk-button-danger"
                            hx-get="/titles/{t.id}/delete"
                            hx-target="#title-modal-body"
                            hx-on::after-request="UIkit.modal('#title-modal').show()"
                            uk-tooltip="Delete Title"
                        >
                            <span uk-icon="trash"></span>
                        </button>
                    </div>
                </td>
            </tr>
            {/for}
        </tbody>
    </table>
</div>
{/if}
{/fragment}

{#fragment id='modal_create' rendered=false}
{@io.archton.scaffold.entity.Title title}
{@String error}
<h2 class="uk-modal-title">Add Title</h2>
{#if error??}
<div class="uk-alert uk-alert-danger">{error}</div>
{/if}
<form hx-post="/titles" hx-target="#title-modal-body">
    <div class="uk-margin">
        <label class="uk-form-label">Code *</label>
        <input class="uk-input" type="text" name="code" maxlength="5" value="{title.code ?: ''}" required />
    </div>
    <div class="uk-margin">
        <label class="uk-form-label">Description *</label>
        <input class="uk-input" type="text" name="description" value="{title.description ?: ''}" required />
    </div>
    <div class="uk-margin uk-text-right">
        <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
        <button class="uk-button uk-button-primary" type="submit">Save</button>
    </div>
</form>
{/fragment}

{#fragment id='modal_edit' rendered=false}
{@io.archton.scaffold.entity.Title title}
{@String error}
<h2 class="uk-modal-title">Edit Title</h2>
{#if error??}
<div class="uk-alert uk-alert-danger">{error}</div>
{/if}
<form hx-put="/titles/{title.id}" hx-target="#title-modal-body">
    <div class="uk-margin">
        <label class="uk-form-label">Code *</label>
        <input class="uk-input" type="text" name="code" maxlength="5" value="{title.code ?: ''}" required />
    </div>
    <div class="uk-margin">
        <label class="uk-form-label">Description *</label>
        <input class="uk-input" type="text" name="description" value="{title.description ?: ''}" required />
    </div>
    <details class="uk-margin">
        <summary class="uk-text-muted">Audit Information</summary>
        <div class="uk-text-small uk-text-muted uk-margin-small-top">
            <div>Created: {title.createdAt} by {title.createdBy}</div>
            <div>Updated: {title.updatedAt} by {title.updatedBy}</div>
        </div>
    </details>
    <div class="uk-margin uk-text-right">
        <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
        <button class="uk-button uk-button-primary" type="submit">Save</button>
    </div>
</form>
{/fragment}

{#fragment id='modal_success' rendered=false}
{@String message}
{@java.util.List<io.archton.scaffold.entity.Title> titles}
<div hx-on::load="UIkit.modal('#title-modal').hide()"></div>
<div id="title-table-container" hx-swap-oob="innerHTML">
    {#include $table titles=titles /}
</div>
{/fragment}

{#fragment id='modal_success_row' rendered=false}
{@String message}
{@io.archton.scaffold.entity.Title title}
<div hx-on::load="UIkit.modal('#title-modal').hide()"></div>
<template>
<tr id="title-row-{title.id}" hx-swap-oob="outerHTML">
    <td>{title.code}</td>
    <td>{title.description}</td>
    <td>
        <div class="uk-button-group">
            <button class="uk-button uk-button-small uk-button-primary"
                    hx-get="/titles/{title.id}/edit"
                    hx-target="#title-modal-body"
                    hx-on::after-request="UIkit.modal('#title-modal').show()"
                    uk-tooltip="Edit Title">
                <span uk-icon="pencil"></span>
            </button>
            <button class="uk-button uk-button-small uk-button-danger"
                    hx-get="/titles/{title.id}/delete"
                    hx-target="#title-modal-body"
                    hx-on::after-request="UIkit.modal('#title-modal').show()"
                    uk-tooltip="Delete Title">
                <span uk-icon="trash"></span>
            </button>
        </div>
    </td>
</tr>
</template>
{/fragment}

{#fragment id='modal_delete' rendered=false}
{@io.archton.scaffold.entity.Title title}
{@String error}
<h2 class="uk-modal-title">Delete Title</h2>
{#if error??}
<div class="uk-alert uk-alert-danger">{error}</div>
{#else}
<div class="uk-alert uk-alert-warning">
    Are you sure you want to delete <strong>{title.code}</strong> - <strong>{title.description}</strong>?
</div>
<p class="uk-text-muted">This action cannot be undone.</p>
{/if}
<div class="uk-margin uk-text-right">
    <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
    {#if !error??}
    <button class="uk-button uk-button-danger"
            hx-delete="/titles/{title.id}"
            hx-target="#title-modal-body">
        Delete
    </button>
    {/if}
</div>
{/fragment}

{#fragment id='modal_delete_success' rendered=false}
{@Long deletedId}
<div hx-on::load="UIkit.modal('#title-modal').hide()"></div>
<template><tr id="title-row-{deletedId}" hx-swap-oob="delete"></tr></template>
{/fragment}
